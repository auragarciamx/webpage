name: Validate Code Quality

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Check file structure
      run: |
        echo "üîç Validating project structure..."
        
        # Check required files exist
        required_files=("index.html" ".gitignore" "src/components/App.js" "src/config/app.config.js" "src/styles/main.css")
        for file in "${required_files[@]}"; do
          if [ -f "$file" ]; then
            echo "‚úÖ $file exists"
          else
            echo "‚ùå $file is missing"
            exit 1
          fi
        done
        
        # Check directories exist
        required_dirs=("src" "src/components" "src/config" "src/styles" "resources" "resources/logos")
        for dir in "${required_dirs[@]}"; do
          if [ -d "$dir" ]; then
            echo "‚úÖ $dir exists"
          else
            echo "‚ùå $dir is missing"
            exit 1
          fi
        done
        
        echo "‚úÖ Project structure validation passed"
        
    - name: Validate HTML syntax
      run: |
        echo "üîç Validating HTML syntax..."
        
        # Basic HTML validation
        if grep -q "<!DOCTYPE html>" index.html; then
          echo "‚úÖ DOCTYPE declaration found"
        else
          echo "‚ùå DOCTYPE declaration missing"
          exit 1
        fi
        
        if grep -q "<html" index.html; then
          echo "‚úÖ HTML tag found"
        else
          echo "‚ùå HTML tag missing"
          exit 1
        fi
        
        if grep -q "<head>" index.html; then
          echo "‚úÖ Head section found"
        else
          echo "‚ùå Head section missing"
          exit 1
        fi
        
        if grep -q "<body>" index.html; then
          echo "‚úÖ Body section found"
        else
          echo "‚ùå Body section missing"
          exit 1
        fi
        
        echo "‚úÖ HTML syntax validation passed"
        
    - name: Check for sensitive information
      run: |
        echo "üîç Checking for sensitive information..."
        
        # Check for potential API keys or secrets
        sensitive_patterns=(
          "api[_-]?key"
          "secret"
          "password"
          "token"
          "private[_-]?key"
        )
        
        for pattern in "${sensitive_patterns[@]}"; do
          if grep -r -i "$pattern" . --exclude-dir=.git --exclude="*.md" --exclude=".github/**"; then
            echo "‚ö†Ô∏è  Potential sensitive information found with pattern: $pattern"
            echo "Please review the files above and ensure no secrets are committed"
          fi
        done
        
        echo "‚úÖ Sensitive information check completed"
        
    - name: Validate CSS
      run: |
        echo "üîç Validating CSS structure..."
        
        if [ -f "src/styles/main.css" ]; then
          echo "‚úÖ Main CSS file exists"
          
          # Check for basic CSS structure
          if grep -q "{" src/styles/main.css; then
            echo "‚úÖ CSS syntax appears valid"
          else
            echo "‚ö†Ô∏è  CSS file may be empty or invalid"
          fi
        else
          echo "‚ùå Main CSS file missing"
          exit 1
        fi
        
        echo "‚úÖ CSS validation passed"
        
    - name: Check JavaScript syntax
      run: |
        echo "üîç Validating JavaScript syntax..."
        
        # Check main App.js file
        if [ -f "src/components/App.js" ]; then
          echo "‚úÖ App.js file exists"
          
          # Basic syntax check
          if grep -q "function\|const\|let\|var" src/components/App.js; then
            echo "‚úÖ JavaScript syntax appears valid"
          else
            echo "‚ö†Ô∏è  App.js may be empty or invalid"
          fi
        else
          echo "‚ùå App.js file missing"
          exit 1
        fi
        
        # Check config file
        if [ -f "src/config/app.config.js" ]; then
          echo "‚úÖ Config file exists"
        else
          echo "‚ùå Config file missing"
          exit 1
        fi
        
        echo "‚úÖ JavaScript validation passed"
        
    - name: Check resource files
      run: |
        echo "üîç Validating resource files..."
        
        # Check for logo files
        logo_count=$(find resources/logos -name "*.png" -o -name "*.svg" -o -name "*.pdf" | wc -l)
        if [ "$logo_count" -gt 0 ]; then
          echo "‚úÖ Found $logo_count logo files"
        else
          echo "‚ö†Ô∏è  No logo files found"
        fi
        
        # Check for font files
        font_count=$(find resources/fonts -name "*.otf" -o -name "*.ttf" -o -name "*.woff" | wc -l)
        if [ "$font_count" -gt 0 ]; then
          echo "‚úÖ Found $font_count font files"
        else
          echo "‚ö†Ô∏è  No font files found"
        fi
        
        echo "‚úÖ Resource validation completed"
        
    - name: Generate validation report
      if: always()
      run: |
        echo "üìä Validation Summary:"
        echo "===================="
        echo "‚úÖ Project structure: Valid"
        echo "‚úÖ HTML syntax: Valid"
        echo "‚úÖ CSS structure: Valid"
        echo "‚úÖ JavaScript syntax: Valid"
        echo "‚úÖ Resources: Found"
        echo ""
        echo "üéâ All validations passed successfully!"
